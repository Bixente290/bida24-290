<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BixFlix</title>
    <link rel="stylesheet" href="net.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Add Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
</head>
<body>

    <header>
        <a href="#" class="logo">BixFlix</a>
        <nav class="nav">
            <ul class="nav-list">
                <li><a href="Trends.html" class="nav-link">Home</a></li>
                <li><a href="#" class="nav-link">Movies</a></li>
                <li><a href="#" class="nav-link">Shows</a></li>
                <li class="dropdown">
                    <a href="#" class="nav-link">More <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a href="#" class="dropdown-link">About Us</a>
                        <a href="#" class="dropdown-link">Contact</a>
                        <a href="#" class="dropdown-link">FAQ</a>
                        <a href="#" class="dropdown-link">Privacy Policy</a>
                        <a href="#" class="dropdown-link">Thank Bixente</a>
                    </div>
                </li>
            </ul>
            <div class="search">
                <input type="text" class="search-input" placeholder="Search" id="movieSearchInput">
                <i class="fa fa-search search-icon" id="searchButton"></i>
            </div>
        </nav>
    </header>

    <section class="banner">
        <div class="banner-content active">
            <h2 class="banner-title">Final Fantasy VII: Advent Children</h2>
            <div class="movie-meta">
                <span>PG-13</span>
                <span>2h 1min</span>
                <span>Action</span>
            </div>
            <p class="banner-description">Two years after leading the charge against Sephiroth, Cloud must face a new threat from three mysterious brothers.</p>
            <div class="button-group">
                <a href="#" class="btn btn-watch"><i class="fa fa-play"></i> Watch Now</a>
                <a href="#" class="btn btn-list"><i class="fa fa-list"></i> Add to List</a>
            </div>
        </div>

        <div class="carousel-box">
            <div class="carousel main-carousel">
                <div class="carousel-item" data-index="0">
                    <img src="images/poster/Final-Fantasy-7-Advent-Children-Poster-1.avif" alt="Final Fantasy VII: Advent Children" loading="lazy">
                </div>
                <div class="carousel-item" data-index="1">
                    <img src="images/poster/super-mario-bros-poster.jpg" alt="Super Mario Bros" loading="lazy">
                </div>
                <div class="carousel-item" data-index="2">
                    <img src="images/poster/onepiecest.png" alt="One Piece Stampede" loading="lazy">
                </div>
                <div class="carousel-item" data-index="3">
                    <img src="images/poster/Dune-poster-of-giant-dune.avif" alt="Dune" loading="lazy">
                </div>
                <!-- Add more carousel items -->
            </div>
            <div class="play-trailer">
                <i class="fa fa-circle-play"></i> Play Trailer
            </div>
        </div>
    </section>

    <section class="trending-movies">
        <h2>Trending Movies</h2>
        <div class="movie-slider trending-slider">
            <!-- Trending movies will be added here dynamically -->
        </div>
    </section>

    <section class="genres">
        <h2>Genres</h2>
        <div class="genre-sections">
            <!-- Genre sections will be added here dynamically -->
        </div>
    </section>

    <div class="trailer">
        <div class="trailer-container">
            <video src="trailers/ff7_adventchilren.mp4" controls></video>
            <i class="fa fa-times close-trailer"></i>
        </div>
    </div>

    <!-- Add jQuery and Slick Carousel JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
        const banner = document.querySelector('.banner');
        const bannerTitle = document.querySelector('.banner-title');
        const movieMeta = document.querySelector('.movie-meta');
        const bannerDescription = document.querySelector('.banner-description');
        const mainCarousel = document.querySelector('.main-carousel'); // Corrected selector
        const carouselItems = document.querySelectorAll('.carousel-item');
        const trendingSlider = document.querySelector('.trending-slider');
        const genreSections = document.querySelector('.genre-sections');
        const movieSearchInput = document.getElementById('movieSearchInput');
        const searchButton = document.getElementById('searchButton');

        // Movie Data (from previous response)
        let movies = [ // Changed to let so we can update it
            {
                title: "Final Fantasy VII: Advent Children",
                meta: "PG-13 | 2h 1min | Action",
                description: "Two years after leading the charge against Sephiroth, Cloud must face a new threat from three mysterious brothers.",
                backgroundImage: "images/movies/finalfantasyadvent.jpg",
                genre: "Action",
                isTrending: true,
                posterImage: "images/poster/Final-Fantasy-7-Advent-Children-Poster-1.avif",
                id: 1 // Added an ID
            },
            {
                title: "Super Mario Bros",
                meta: "PG | 1h 32min | Animation",
                description: "Brooklyn plumbers Mario and Luigi find themselves in the Mushroom Kingdom, where they must team up with Princess Peach to stop the villainous Bowser.",
                backgroundImage: "images/movies/mario.jpg",
                genre: "Animation",
                isTrending: false,
                posterImage: "images/poster/super-mario-bros-poster.jpg",
                id: 2
            },
            {
                title: "One Piece Stampede",
                meta: "PG-13 | 1h 41min | Adventure",
                description: "Pirates from across the world gather for a legendary festival, chasing after Gol D. Rogerâ€™s treasure.",
                backgroundImage: "images/movies/onepiece-stampede.avif",
                genre: "Adventure",
                isTrending: true,
                posterImage: "images/poster/onepiecest.png",
                id: 3
            },
            {
                title: "Dune",
                meta: "PG-13 | 2h 35min | Sci-Fi",
                description: "A noble family becomes embroiled in a war for control over the galaxy's most valuable asset while its heir becomes troubled by visions of a dark future.",
                backgroundImage: "images/movies/dune-7.webp",
                genre: "Sci-Fi",
                isTrending: true,
                posterImage: "images/poster/Dune-poster-of-giant-dune.avif",
                id: 4
            },
            // Add more movie data
        ];

        // TMDb API Key
        const TMDB_API_KEY = 'YOUR_TMDB_API_KEY'; // Replace with my actual API key

        // Function to update banner content
        function updateBanner(index) {
            const movie = movies[index];
            bannerTitle.textContent = movie.title;
            movieMeta.textContent = movie.meta;
            bannerDescription.textContent = movie.description;
            banner.style.backgroundImage = `url(${movie.backgroundImage})`;
        }

        // Event listener for carousel item clicks (Simulating a carousel change)
        carouselItems.forEach(item => {
            item.addEventListener('click', () => {
                const index = parseInt(item.dataset.index);
                updateBanner(index);
            });
        });

        // Initialize banner with the first movie
        updateBanner(0);

        // Trailer Modal Logic (unchanged)
        const trailer = document.querySelector('.trailer');
        const closeTrailer = document.querySelector('.close-trailer');
        const playTrailerButton = document.querySelector('.play-trailer');

        playTrailerButton.addEventListener('click', () => {
            trailer.classList.add('active');
        })

        closeTrailer.addEventListener('click', () => {
            trailer.classList.remove('active');
        })

        // --- New Code for Trending and Genres ---

        // 1. Filter Trending Movies
        const trendingMovies = movies.filter(movie => movie.isTrending);

        // 2. Function to Generate Movie Slider HTML (Posters Only)
        function generateMovieSliderHTML(moviesArray) {
            let sliderHTML = '';
            moviesArray.forEach(movie => {
                sliderHTML += `
                    <div class="movie-item" data-movie-id="${movie.id}">
                        <img src="${movie.posterImage}" alt="${movie.title}" loading="lazy">
                    </div>
                `;
            });
            return sliderHTML;
        }

        // 3. Add Trending Movies to Slider
        trendingSlider.innerHTML = generateMovieSliderHTML(trendingMovies);

        // 4. Initialize Slick Carousel for Trending Movies
        $(trendingSlider).slick({
            dots: false,
            infinite: true,
            speed: 300,
            slidesToShow: 4, // Adjust as needed
            slidesToScroll: 1,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 3
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1
                    }
                }
            ]
        });

        // 5. Get Unique Genres
        const uniqueGenres = [...new Set(movies.map(movie => movie.genre))];

        // 6. Function to Generate Genre Section HTML
        function generateGenreSectionHTML(genre) {
            return `
                <div class="genre-section">
                    <h2>${genre}</h2>
                    <div class="movie-slider genre-slider">
                        <!-- Movies for this genre will be added here -->
                    </div>
                </div>
            `;
        }

        // 7. Add Genre Sections to HTML
        uniqueGenres.forEach(genre => {
            genreSections.innerHTML += generateGenreSectionHTML(genre);
        });

        // 8. Populate Genre Sections with Movies
        const genreSectionsList = document.querySelectorAll('.genre-section');
        genreSectionsList.forEach(genreSection => {
            const genre = genreSection.querySelector('h2').textContent;
            const genreMovies = movies.filter(movie => movie.genre === genre);
            const genreSlider = genreSection.querySelector('.genre-slider');
            genreSlider.innerHTML = generateMovieSliderHTML(genreMovies);

            // Initialize Slick Carousel for each genre
            $(genreSlider).slick({
                dots: false,
                infinite: true,
                speed: 300,
                slidesToShow: 4, // Adjust as needed
                slidesToScroll: 1,
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 600,
                        settings: {
                            slidesToShow: 2
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1
                        }
                    }
                ]
            });
        });

        // Initialize Slick Carousel for Main Carousel
        $(mainCarousel).slick({
            dots: false,
            infinite: true,
            speed: 300,
            slidesToShow: 3, // Adjust as needed
            slidesToScroll: 1,
            centerMode: true,
            variableWidth: true,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 3
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1
                    }
                }
            ]
        });

        // Event Delegation for Trending Movies
        trendingSlider.addEventListener('click', function(event) {
            const movieItem = event.target.closest('.movie-item'); // Click on image or div
            if (movieItem) {
                const movieId = movieItem.dataset.movieId;
                console.log("Clicked on trending movie with ID:", movieId);
                // Add logic to handle the click (e.g., show movie details)
            }
        });

        // Event Delegation for Genre Movies
        genreSections.addEventListener('click', function(event) {
            const movieItem = event.target.closest('.movie-item');
            if (movieItem) {
                const movieId = movieItem.dataset.movieId;
                console.log("Clicked on genre movie with ID:", movieId);
                // Add logic to handle the click (e.g., show movie details)
            }
        });

        // Example of fetching data (replace with your actual API endpoint)
        async function loadMovies() {
            try {
                // const response = await fetch('/api/movies'); // Replace with your API endpoint
                // movies = await response.json();
                // After loading, re-render the sliders
                trendingSlider.innerHTML = generateMovieSliderHTML(trendingMovies);
                // Re-initialize Slick Carousel for trendingSlider
                $(trendingSlider).slick('refresh'); // Important to refresh after updating content

                genreSectionsList.forEach(genreSection => {
                    const genre = genreSection.querySelector('h2').textContent;
                    const genreMovies = movies.filter(movie => movie.genre === genre);
                    const genreSlider = genreSection.querySelector('.genre-slider');
                    genreSlider.innerHTML = generateMovieSliderHTML(genreMovies);
                    $(genreSlider).slick('refresh'); // Refresh each genre slider
                });

            } catch (error) {
                console.error("Error loading movies:", error);
            }
        }

        // loadMovies(); // Call this function when the page loads

        // --- TMDb API Integration ---

        // Function to fetch movies from TMDb
        async function fetchMoviesFromTMDb(query) {
            const url = `https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${query}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.results; // Returns an array of movie objects
            } catch (error) {
                console.error("Error fetching movies from TMDb:", error);
                return [];
            }
        }

        // Function to process TMDb movie data into my website's format
        function processTMDbMovieData(tmdbMovie) {
            // Example:
            return {
                title: tmdbMovie.title,
                meta: `PG | ${tmdbMovie.release_date.substring(0, 4)} | ...`, // Adjust as needed
                description: tmdbMovie.overview,
                backgroundImage: `https://image.tmdb.org/t/p/w500${tmdbMovie.backdrop_path}`, // Adjust size as needed
                genre: "Unknown", // You might need to fetch genre separately
                isTrending: false, // Set based on your logic
                posterImage: `https://image.tmdb.org/t/p/w500${tmdbMovie.poster_path}`, // Adjust size as needed
                id: movies.length + 1 // Generate a unique ID
            };
        }

        // Function to add a movie to the website
        function addMovieToWebsite(tmdbMovie) {
            const processedMovie = processTMDbMovieData(tmdbMovie);
            movies.push(processedMovie);

            // Update trending status (example)
            if (movies.length % 2 === 0) {
                processedMovie.isTrending = true;
            }

            // Re-render the sliders
            trendingSlider.innerHTML = generateMovieSliderHTML(movies.filter(movie => movie.isTrending));
            genreSectionsList.forEach(genreSection => {
                const genre = genreSection.querySelector('h2').textContent;
                const genreMovies = movies.filter(movie => movie.genre === genre);
                const genreSlider = genreSection.querySelector('.genre-slider');
                genreSlider.innerHTML = generateMovieSliderHTML(genreMovies);
                $(genreSlider).slick('refresh'); // Refresh each genre slider
            });
            $(trendingSlider).slick('refresh'); // Refresh trending slider

            console.log("Added movie:", processedMovie.title);
        }

        // Event listener for the search button
        searchButton.addEventListener('click', async () => {
            const query = movieSearchInput.value;
            if (query) {
                const tmdbMovies = await fetchMoviesFromTMDb(query);
                if (tmdbMovies.length > 0) {
                    // For simplicity, let's add the first movie from the results
                    addMovieToWebsite(tmdbMovies[0]);
                } else {
                    alert("No movies found for that search query.");
                }
            } else {
                alert("Please enter a search query.");
            }
        });
        
    </script>

</body>
</html>